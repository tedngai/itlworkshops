<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Data Visualization Workshop Climate Data Visualization | pratt itl </title> <meta name="description" content=" Python "> <meta name="keywords" content="technology, education, art, design, new york, brooklyn, architecture"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="ITL"> <meta property="article:section" content=""> <meta property="article:tag" content=""> <meta property="article:published_time" content="2018-09-04 00:00:00 -0400"> <meta property="og:url" content="http://localhost:4000/itlworkshops/2018/GIS_Workshop_ClimateViz/"> <meta property="og:title" content=" Data Visualization Workshop Climate Data Visualization | pratt itl "> <meta property="og:image" content="http://localhost:4000/itlworkshops"> <meta property="og:description" content=" Python "> <meta property="og:site_name" content="ITL"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" Data Visualization Workshop Climate Data Visualization | pratt itl "> <meta name="twitter:description" content=" Python "> <meta name="twitter:image:src" content="http://localhost:4000/itlworkshops"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Data Visualization Workshop Climate Data Visualization | pratt itl "> <meta itemprop="description" content=" Python "> <meta itemprop="image" content="http://localhost:4000/itlworkshops"> <!-- Canonical link tag --> <link rel="canonical" href="http://localhost:4000/itlworkshops/2018/GIS_Workshop_ClimateViz/"> <link rel="alternate" type="application/rss+xml" title="pratt itl" href="http://localhost:4000/itlworkshops/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="http://localhost:4000/itlworkshops/assets/css/main.css"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="http://localhost:4000/itlworkshops/">pratt <span>itl</span></a></h1> <ul class="navbar"> <li><a href="http://localhost:4000/itlworkshops/about">About me</a></li> <li><a href="http://localhost:4000/itlworkshops/feed.xml" target="_blank">RSS</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"><time datetime="2018-09-04T00:00:00-04:00" itemprop="datePublished">Sep 4, 2018</time></p> <h1 class="post-title" itemprop="name headline">Data Visualization Workshop Climate Data Visualization</h1> </header> <div class="post-content" itemprop="articleBody"> <p><img src="../../assets/images/climate/MERRA2-2m_airTemp_Test.png" alt="MERRA2-2m_airTemp_Test" /></p> <h2 id="project-description">Project Description</h2> <p>This workshop will go through some basic workflow for accessing and visualizing climate data using Python. You can find many datasets from NASA’s <a href="https://disc.gsfc.nasa.gov/" target="_blank">Goddard Earth Science Data and Information Services Center’s Earth Data portal</a>. It is an invaluable resource and we have access to climate data at the global level all the way back to 1980. This workshop will focus mainly on the techniques to handle NetCDF file format and to display global maps within iPython. The material presented should allow you understand, access, and visualize many datasets. And for this session we will use dataset from the <strong>Modern-Era Retrospective analysis for Research and Applications version 2 (MERRA-2)</strong> to look at global air temperature, and from the <strong>Gravity Recovery and Climate Experiment Data Assimilation Product Version2.0 (GRACE-DA-DM v2.0)</strong> to look at groundwater and soil moisture conditions .</p> <hr /> <h1 id="step-1">Step 1</h1> <h3 id="python-installation">Python Installation</h3> <p>Please follow the steps detailed in the <a href="https://tedngai.github.io/itlworkshops/2019/DataSci01/" target="_blank">Data Science Intro</a> for instructions to install Anaconda and create virtual environments. There is step-by-step instructions there.</p> <p>You will want to create a new virtual environment for this workshop, and you will need the following packages, netCDF4, numpy, matplotlib, and basemap. First create a new virtual environment.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create -n climateViz python=3.7
</code></pre></div></div> <p>Once it’s done, activtate the envionrment</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda activate climateViz
</code></pre></div></div> <p>Now install the following packages</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda install numpy netCDF4 matplotlib basemap
</code></pre></div></div> <hr /> <h1 id="step-2">Step 2</h1> <h3 id="download-climate-data">Download Climate Data</h3> <p>To access NASA’s climate data, you need to register with Earthdata and agree to a few End User License Agreements.</p> <ol> <li>Follow the steps <a href="https://disc.gsfc.nasa.gov/data-access" target="_blank">here</a> to register with Earthdata.</li> <li>After registration, go to <a href="https://disc.gsfc.nasa.gov/" target="_blank">Earth Data Portal</a> and search for <strong>M2TMNXSLV</strong>. Then Click on the link.</li> <li>You can access the data in multiple ways, but for our purpose, click <strong>Online Archive</strong>. This is a monthly dataset that dates back to 1980. You can choose any dataset you desire. For this exercise, we are using the data from Dec 2012. Click on <strong><a href="https://goldsmr4.gesdisc.eosdis.nasa.gov/data/MERRA2_MONTHLY/M2TMNXSLV.5.12.4/2012/MERRA2_400.tavgM_2d_slv_Nx.201212.nc4">MERRA2_400.tavgM_2d_slv_Nx.201212.nc4</a></strong></li> </ol> <p>You should now have a the file in your local drive. Move the file to a new folder, open a <strong>Terminal</strong> or <strong>Anaconda Prompt</strong> and go to the directory that contains the downloaded file, then type <strong>Jupyter Notebook</strong> and create a new notebook.</p> <hr /> <h1 id="step-3">Step 3</h1> <h3 id="visualize-data">Visualize Data</h3> <p>The following workflow is built on the <a href="https://disc.gsfc.nasa.gov/information/howto?title=How%20to%20read%20and%20plot%20NetCDF%20MERRA-2%20data%20in%20Python" target="_blank">How to read and plot NetCDF MERRA-2 data in Python</a> provided by GES DISC. The howto provided assumes an audience with programming experience whereas this workshop does not, so we will look more specifically into the functions and explain each step in more details.</p> <p>First you need to import all the relevant libraries python will use.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>
</code></pre></div></div> <p>Now import the dataset into a variable.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="s">'MERRA2_400.tavgM_2d_slv_Nx.201212.nc4'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
</code></pre></div></div> <p>What we need to know is what kind of data is contained in the NetCDF file. NetCDF (Network Common Data Form) is a “self-describing” file format that contains all the metadata and is used primarily for sharing scientific data. Thus, once we loaded the file, we can access what is inside the dataset by printing the metadata.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root group (NETCDF4 data model, file format HDF5):
    History: Original file generated: Mon Jul  6 14:42:10 2015 GMT
    Filename: MERRA2_400.tavgM_2d_slv_Nx.201212.nc4
    Comment: GMAO filename: d5124_m2_jan10.tavg1_2d_slv_Nx.monthly.201212.nc4
    Conventions: CF-1
    Institution: NASA Global Modeling and Assimilation Office
    References: http://gmao.gsfc.nasa.gov
    Format: NetCDF-4/HDF-5
    SpatialCoverage: global
    VersionID: 5.12.4
    TemporalRange: 1980-01-01 -&gt; 2016-12-31
    identifier_product_doi_authority: http://dx.doi.org/
    ShortName: M2TMNXSLV
    RangeBeginningDate: 2012-12-01
    RangeEndingDate: 2012-12-31
    GranuleID: MERRA2_400.tavgM_2d_slv_Nx.201212.nc4
    ProductionDateTime: Original file generated: Mon Jul  6 14:42:10 2015 GMT
    LongName: MERRA2 tavg1_2d_slv_Nx: 2d,1-Hourly,Time-Averaged,Single-Level,Assimilation,Single-Level Diagnostics Monthly Mean
    Title: MERRA2 tavg1_2d_slv_Nx: 2d,1-Hourly,Time-Averaged,Single-Level,Assimilation,Single-Level Diagnostics Monthly Mean
    SouthernmostLatitude: -90.0
    NorthernmostLatitude: 90.0
    WesternmostLongitude: -180.0
    EasternmostLongitude: 179.375
    LatitudeResolution: 0.5
    LongitudeResolution: 0.625
    DataResolution: 0.5 x 0.625
    Source: CVS tag: GEOSadas-5_12_4
    Contact: http://gmao.gsfc.nasa.gov
    identifier_product_doi: 10.5067/AP1B0BA5PD2K
    RangeBeginningTime: 00:00:00.000000
    RangeEndingTime: 23:59:59.000000
    dimensions(sizes): lon(576), lat(361), time(1)
    variables(dimensions): float64 lon(lon), float64 lat(lat), int32 time(time)...
</code></pre></div></div> <p>What we are interested in is in the variables section. We want to see how many variables there are and how the data is structured. Type <code class="highlighter-rouge">len(data.variables)</code> and you can see there are 97 variables, but the variable names are coded and it’s hard to understand what they are. You can access more information by typing</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print(data.variables)
</code></pre></div></div> <p>You will see a print out of all the metadata for the specific variables. You will find a more descriptive long name, units, data type, and dimensions. As you go into the description, you will find that there are many interesting variables in this file such as <strong>TQV</strong> (Total Precipitable Water Vapor), <strong>TQL</strong> (Total Precipitable Liquid Water), <strong>TOX</strong> (Total Column Odd Oxygen), <strong>TO3</strong> (Total column Ozone)…etc. What we will look at for this exercise is the <strong>T2M</strong> (2-meter Air Tempeature ).</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>('lon', &lt;class 'netCDF4._netCDF4.Variable'&gt;
float64 lon(lon)
    long_name: longitude
    units: degrees_east
    vmax: 1000000000000000.0
    vmin: -1000000000000000.0
    valid_range: [-1.e+15  1.e+15]
unlimited dimensions: 
current shape = (576,)
filling on, default _FillValue of 9.969209968386869e+36 used
),

('lat', &lt;class 'netCDF4._netCDF4.Variable'&gt;
float64 lat(lat)
    long_name: latitude
    units: degrees_north
    vmax: 1000000000000000.0
    vmin: -1000000000000000.0
    valid_range: [-1.e+15  1.e+15]
unlimited dimensions: 
current shape = (361,)
filling on, default _FillValue of 9.969209968386869e+36 used
),

('T2M', &lt;class 'netCDF4._netCDF4.Variable'&gt;
float32 T2M(time, lat, lon)
    long_name: 2-meter_air_temperature
    units: K
    _FillValue: 1000000000000000.0
    missing_value: 1000000000000000.0
    fmissing_value: 1000000000000000.0
    vmax: 1000000000000000.0
    vmin: -1000000000000000.0
    valid_range: [-1.e+15  1.e+15]
unlimited dimensions: time
current shape = (1, 361, 576)
filling on)
</code></pre></div></div> <p>Create the following new variables. Notice the <code class="highlighter-rouge">[]</code> after the variables, they specify the dimension of the data you want to create. Both <strong>longitude</strong> and <strong>latitude</strong> are 1 dimension whereas <strong>T2M</strong> has 3 dimensions as is described - <strong>float32 T2M(time, lat, lon)</strong> and <strong>current shape = (1, 361, 576)</strong>. Since this file is a monthly dataset and we only downloaded only for a specific month, the time dimension has only 1 layer of data, therefore <code class="highlighter-rouge">[0,:,:]</code> is used.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lons</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">'lon'</span><span class="p">][:]</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">'lat'</span><span class="p">][:]</span>
<span class="n">T2M</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s">'T2M'</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:]</span>
</code></pre></div></div> <p>Now we setup a map with all the relevant parameters such as projection, resolution, meshgrid…etc. For more information on basemap parameters and functionality.</p> <center><button class="button"> <a href="https://matplotlib.org/basemap/api/basemap_api.html" target="_blank">Deep Dive: Basemap API Parameters</a> </button></center> <p><br /></p> <center><button class="button"> <a href="https://matplotlib.org/basemap/users/mapsetup.html" target="_blank">Deep Dive: Map Projections</a> </button></center> <p><br /></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">map</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s">'l'</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">'gall'</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
</code></pre></div></div> <p>Numpy’s meshgrid creates a 2-dimensional array from latitude and longitude. <code class="highlighter-rouge">map(lon, lat)</code> takes the world coordinates and project them to the map’s coordinate. If you check the shape of the variables, you should see they all have the same dimensionality.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>print(xi.shape, yi.shape, T2M.shape)
(361, 576) (361, 576) (361, 576)
</code></pre></div></div> <p>Now it’s time to plot.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">cs</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">T2M</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">(</span><span class="n">T2M</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">T2M</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s">'face'</span><span class="p">)</span>

<span class="nb">map</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
<span class="nb">map</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'MERRA2-2m_airTemp_Test.png'</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s">'tight'</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div> <p><code class="highlighter-rouge">plt.figure</code> sets the dimension of the plot. <code class="highlighter-rouge">figsize</code> is in inches and multiply that with <code class="highlighter-rouge">dpi</code> you get a pixel count. <code class="highlighter-rouge">map.pcolor</code> we set the vallues for x, y, temperature. <code class="highlighter-rouge">vmin</code> is the lowest temperature value and <code class="highlighter-rouge">vmax</code> is the highest temperature value. <code class="highlighter-rouge">cmap</code> sets the colormap option and in this case we are using <strong>jet</strong>.</p> </div> </article> <footer class="site-footer"> <div class="container"> <small class="block">&copy; 2019 ITL &middot; &lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/thinkspace">Thinkspace theme</a></small> </div> </footer> </main> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-XXXXX-XX']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>
